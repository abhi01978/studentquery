<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCQs</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

<h1 class="text-3xl font-bold mb-6 text-center">MCQs</h1>

<div id="mcq-container" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>

<script>
async function loadMCQs() {
  try {
    const res = await fetch('/api/mcqs');
    const data = await res.json();

    const container = document.getElementById('mcq-container');
    container.innerHTML = "";

    if (data.mcqs.length === 0) {
      container.innerHTML = "<p class='text-center'>No MCQs found.</p>";
      return;
    }

    data.mcqs.forEach((q, idx) => {
      const card = document.createElement("div");
      card.className = "p-4 bg-white rounded shadow";

      card.innerHTML = `
        <p class="font-bold mb-2">${idx+1}. ${q.question}</p>
        <ul class="ml-4">
          ${q.options.map((o, i) => `
            <li 
              class="option p-2 border rounded mb-2 cursor-pointer hover:bg-gray-100"
              data-answer="${q.answer}"
              data-option="${o}"
            >
              ${o}
            </li>
          `).join('')}
        </ul>
        <p class="mt-2 font-semibold message"></p>
      `;

      // Add click functionality
      const options = card.querySelectorAll(".option");
      const message = card.querySelector(".message");
      let clicked = false;

      options.forEach(opt => {
        opt.addEventListener("click", () => {
          if (clicked) return; // prevent multiple clicks
          clicked = true;

          const correct = opt.dataset.answer;
          const chosen = opt.dataset.option;

          if (chosen === correct) {
            opt.classList.add("bg-green-200", "border-green-500");
            message.textContent = "Correct Answer ✔";
            message.classList.add("text-green-600");
          } else {
            opt.classList.add("bg-red-200", "border-red-500");
            message.textContent = `Wrong Answer ✘ (Correct: ${correct})`;
            message.classList.add("text-red-600");

            // Highlight correct option
            options.forEach(o => {
              if (o.dataset.option === correct) {
                o.classList.add("bg-green-200", "border-green-500");
              }
            });
          }

          // Disable all options after one click
          options.forEach(o => (o.style.pointerEvents = "none"));
        });
      });

      container.appendChild(card);
    });

  } catch (err) {
    console.error("Error loading MCQs:", err);
    document.getElementById('mcq-container').innerHTML = "<p class='text-center'>Failed to load MCQs.</p>";
  }
}

window.onload = loadMCQs;
</script>

</body>
</html>
